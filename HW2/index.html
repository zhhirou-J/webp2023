<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>景點觀光展覽資訊</title>
  </head>
  <body>
    <h1>景點觀光展覽資訊</h1>
    <table id="csie" class="table table-striped table-hover">
        <tr>
          <th>名稱</th>
          <th>地點</th>
          <th>票價</th>
        </tr>
    </table>
    <button onclick="goToPage(-1)">上一頁</button>
    <button onclick="goToPage(1)">下一頁</button>
    <script>
      var openUrl = "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6";
      var xhr = new XMLHttpRequest();
      xhr.open('GET', openUrl, true);
      xhr.send();
      xhr.onreadystatechange = function(){
        if(this.readyState == 4 && this.status == 200){
          dataset = JSON.parse(this.responseText);  
          addNewData(dataset); 
        }
      };
      var currentPage = 1;
      var itemsPerPage = 10;
      function addNewData(dataset){
        var myTable = document.getElementById("csie");
        var startIndex = (currentPage - 1) * itemsPerPage;
        var endIndex = startIndex + itemsPerPage;
        if(endIndex > dataset.length){
          endIndex = dataset.length;
        }
        for(var i = startIndex; i < endIndex; i++){
          var row = myTable.insertRow(-1);
          row.insertCell(0).innerHTML = dataset[i]['title'];
          row.insertCell(1).innerHTML = dataset[i]['showInfo'][0]['location'];
          row.insertCell(2).innerHTML = dataset[i]['showInfo'][0]['price'];
        }
      }
      function delOldData(){
         var myTable = document.getElementById ("csie");
         var rowCount = myTable.rows.length;
         while(rowCount > 1)
           myTable.deleteRow(-1);
       }
      function goToPage(direction){
        var myTable = document.getElementById("csie");
        var totalPage = Math.ceil(dataset.length / itemsPerPage);
        currentPage += direction;
        if(currentPage < 1){
          currentPage = 1;
        } else if(currentPage > totalPage){
          currentPage = totalPage;
        } 
        delOldData();
        addNewData(dataset);
      }
    </script>
  </body>
</html>
